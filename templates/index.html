<!DOCTYPE html>
<html>
<head>
    <title>Twilio Browser Call</title>
</head>
<body>
    <h2>ðŸ“ž Make a Call from Browser</h2>
    <input id="phoneNumber" placeholder="Enter number" />
    <button onclick="makeCall()">Call</button>
    <button onclick="hangupCall()">Hangup</button>

    <h3>Logs:</h3>
    <pre id="logs"></pre>

    <!-- Load Twilio SDK from local copy -->
    <script src="{{ url_for('static', filename='js/twilio.min.js') }}"></script>

    <script>
        let device;

        function log(msg) {
            console.log(msg);
            document.getElementById("logs").textContent += msg + "\n";
        }

        async function initTwilio() {
            log("Fetching Twilio token...");
            const resp = await fetch("/token");
            const data = await resp.json();
            const token = data.token;
            log("Token received");

            device = new Twilio.Device(token, { debug: true });

            device.on("ready", () => log("âœ… Device ready"));
            device.on("error", err => log("âŒ Error: " + err.message));
            device.on("connect", conn => log("ðŸ”— Call connected"));
            device.on("disconnect", () => log("ðŸ”Œ Call disconnected"));
            device.on("incoming", call => {
                log("ðŸ“¥ Incoming call from " + call.parameters.From);
                call.accept();
            });
        }

        function makeCall() {
            const number = document.getElementById("phoneNumber").value;
            log("ðŸ“ž Dialing " + number);
            device.connect({ params: { To: number } });
        }

        function hangupCall() {
            log("ðŸ”´ Hanging up call");
            device.disconnectAll();
        }

        initTwilio();
    </script>
</body>
</html>
