<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Twilio Call App</title>
</head>
<body>
  <h1>üìû Call from Browser</h1>

  <input type="text" id="phoneNumber" placeholder="Enter phone number">
  <button onclick="makeCall()">Call</button>
  <button onclick="hangup()">Hangup</button>

  <pre id="logs"></pre>

  <!-- Twilio SDK (downloaded from GitHub release and put in /static/) -->
  <script src="/static/twilio.min.js"></script>
  <script>
    let device;

    function log(msg) {
      console.log(msg);
      document.getElementById('logs').innerText += msg + "\n";
    }

    async function init() {
      log("Fetching Twilio token...");
      const res = await fetch("/token");
      const data = await res.json();
      log("Token received: " + data.identity);

      device = new Twilio.Device(data.token, { debug: true });

      device.on("ready", () => log("‚úÖ Device ready"));
      device.on("error", err => log("‚ùå Device error: " + err.message));
      device.on("incoming", call => {
        log("Incoming call from " + call.parameters.From);
        call.accept();
      });
      device.on("connect", () => log("üîó Call connected"));
      device.on("disconnect", () => log("‚ùå Call disconnected"));
    }

    async function makeCall() {
      const number = document.getElementById("phoneNumber").value;
      log("Dialing " + number + "...");
      device.connect({ params: { To: number } });
    }

    function hangup() {
      log("Hanging up...");
      device.disconnectAll();
    }

    init();
  </script>
</body>
</html>
